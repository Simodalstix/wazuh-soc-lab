# Kibana Configuration for Wazuh SOC Lab
# Optimized for 6GB RAM deployment with SOC analyst workflows
# Generated by Ansible

# =============================================================================
# Kibana Configuration
# =============================================================================

# Kibana is served by a back end server. This setting specifies the port to use.
server.port: 5601

# Specifies the address to which the Kibana server will bind. IP addresses and host names are both valid values.
# The default is 'localhost', which usually means remote machines will not be able to connect.
# To allow connections from remote users, set this parameter to a non-loopback address.
server.host: "{{ wazuh_manager_ip }}"

# Enables you to specify a path to mount Kibana at if you are running behind a proxy.
# Use the `server.rewriteBasePath` setting to tell Kibana if it should remove the basePath
# from requests it receives, and to prevent a deprecation warning at startup.
# This setting cannot end in a slash.
#server.basePath: ""

# Specifies whether Kibana should rewrite requests that are prefixed with
# `server.basePath` or require that they are rewritten by your reverse proxy.
#server.rewriteBasePath: false

# Specifies the public URL at which Kibana is available for end users. If
# `server.basePath` is configured this URL should end with the same basePath.
server.publicBaseUrl: "https://{{ wazuh_manager_ip }}:5601"

# The maximum payload size in bytes for incoming server requests.
server.maxPayload: 1048576

# The Kibana server's name.  This is used for display purposes.
server.name: "wazuh-soc-lab-kibana"

# The URLs of the Elasticsearch instances to use for all your queries.
elasticsearch.hosts: ["https://{{ wazuh_manager_ip }}:9200"]

# Kibana uses an index in Elasticsearch to store saved searches, visualizations and
# dashboards. Kibana creates a new index if the index doesn't already exist.
kibana.index: ".kibana"

# The default application to load.
kibana.defaultAppId: "wazuh"

# If your Elasticsearch is protected with basic authentication, these settings provide
# the username and password that the Kibana server uses to perform maintenance on the Kibana
# index at startup. Your Kibana users still need to authenticate with Elasticsearch, which
# is proxied through the Kibana server.
elasticsearch.username: "kibana_system"
elasticsearch.password: "{{ kibana_elasticsearch_password }}"

# Enables SSL and paths to the PEM-format SSL certificate and SSL key files, respectively.
# These settings enable SSL for outgoing requests from the Kibana server to the browser.
server.ssl.enabled: true
server.ssl.certificate: /etc/ssl/wazuh/server-cert.pem
server.ssl.key: /etc/ssl/wazuh/server-key.pem

# Optional settings that provide the paths to the PEM-format SSL certificate and key files.
# These files are used to verify the identity of Kibana to Elasticsearch and are required when
# xpack.security.http.ssl.client_authentication in Elasticsearch is set to required.
elasticsearch.ssl.certificate: /etc/ssl/wazuh/server-cert.pem
elasticsearch.ssl.key: /etc/ssl/wazuh/server-key.pem

# Optional setting that enables you to specify a path to the PEM file for the certificate
# authority for your Elasticsearch instance.
elasticsearch.ssl.certificateAuthorities: [ "/etc/ssl/wazuh/ca-cert.pem" ]

# To disregard the validity of SSL certificates, change this setting's value to 'none'.
elasticsearch.ssl.verificationMode: certificate

# Time in milliseconds to wait for Elasticsearch to respond to pings. Defaults to the value of
# the elasticsearch.requestTimeout setting.
elasticsearch.pingTimeout: 1500

# Time in milliseconds to wait for responses from the back end or Elasticsearch. This value
# must be a positive integer.
elasticsearch.requestTimeout: 30000

# List of Kibana client-side headers to send to Elasticsearch. To send *no* client-side
# headers, set this value to [] (an empty list).
elasticsearch.requestHeadersWhitelist: [ authorization ]

# Header names and values that are sent to Elasticsearch. Any custom headers cannot be overwritten
# by client-side headers, regardless of the elasticsearch.requestHeadersWhitelist configuration.
#elasticsearch.customHeaders: {}

# Time in milliseconds for Elasticsearch to wait for responses from shards. Set to 0 to disable.
elasticsearch.shardTimeout: 30000

# Logs queries sent to Elasticsearch. Requires logging.verbose: true.
elasticsearch.logQueries: false

# Specifies the path where Kibana creates the process ID file.
pid.file: /var/run/kibana/kibana.pid

# Enables you to specify a file where Kibana stores log output.
logging.dest: /var/log/kibana/kibana.log

# Set the value of this setting to true to suppress all logging output.
logging.silent: false

# Set the value of this setting to true to suppress all logging output other than error messages.
logging.quiet: false

# Set the value of this setting to true to log all events, including system usage information
# and all requests.
logging.verbose: false

# Set the interval in milliseconds to sample system and process performance
# metrics. Minimum is 100ms. Defaults to 5000.
ops.interval: 5000

# Specifies locale to be used for all localizable strings, dates and number formats.
# Supported locales are the following: English - en , by default , Chinese - zh-CN .
i18n.locale: "en"

# =============================================================================
# SOC Lab Specific Configuration
# =============================================================================

# Memory optimization for 6GB RAM constraint
node.options.max-old-space-size: 1024

# Performance optimizations
elasticsearch.requestTimeout: 90000
elasticsearch.shardTimeout: 30000

# Security settings
server.ssl.supportedProtocols: ["TLSv1.2", "TLSv1.3"]
server.ssl.cipherSuites: ["ECDHE-RSA-AES128-GCM-SHA256", "ECDHE-RSA-AES256-GCM-SHA384"]

# CORS settings for lab environment
server.cors.enabled: true
server.cors.allowOrigin: ["https://{{ wazuh_manager_ip }}", "https://localhost"]
server.cors.allowCredentials: true

# Session settings
server.maxPayload: 1048576
server.keepaliveTimeout: 120000
server.socketTimeout: 120000

# Monitoring settings
monitoring.enabled: false
monitoring.kibana.collection.enabled: false

# Telemetry settings (disabled for lab)
telemetry.enabled: false
telemetry.optIn: false

# Usage collection (disabled for lab)
usageCollection.uiCounters.enabled: false

# News feed (disabled for lab)
newsfeed.enabled: false

# Advanced settings for SOC operations
map.includeElasticMapsService: false
map.tilemap.url: ""

# Visualization settings
visualization.colorMapping: {}
visualization.regionmap.includeElasticMapsService: false

# Dashboard settings
dashboard.defaultDarkMode: false

# Discover settings
discover.sampleSize: 500
discover.maxDocFieldsDisplayed: 200

# Histogram settings
histogram.barTarget: 50
histogram.maxBars: 100

# Timelion settings
timelion.enabled: true
timelion.ui.enabled: true

# Timeline settings
timeline.enabled: true
timeline.ui.enabled: true

# Canvas settings (disabled to save memory)
canvas.enabled: false

# Machine learning settings (disabled for lab)
ml.enabled: false

# APM settings (disabled for lab)
apm_oss.enabled: false

# Cross cluster search settings
ccs.enabled: false

# Index pattern settings
indexPattern.fieldMapping.lookBack: 5

# Saved objects settings
savedObjects.maxImportPayloadBytes: 26214400
savedObjects.maxImportExportSize: 10000

# Search settings
search.timeout: 600000

# Courier settings
courier.maxConcurrentShardRequests: 5
courier.batchSearches: true

# Format settings
format:defaultTypeMap:
  ip: { id: "ip", params: {} }
  date: { id: "date", params: {} }
  number: { id: "number", params: {} }
  boolean: { id: "boolean", params: {} }
  _source: { id: "_source", params: {} }
  _default_: { id: "string", params: {} }

# Notification settings
notifications.lifetime.banner: 3000000
notifications.lifetime.error: 300000
notifications.lifetime.warning: 10000
notifications.lifetime.info: 5000

# Accessibility settings
accessibility.disableAnimations: false

# Security settings for lab environment
csp.rules: [
  "script-src 'unsafe-eval' 'self'",
  "worker-src blob: 'self'",
  "child-src blob: 'self'"
]

# Memory circuit breaker
elasticsearch.memoryCircuitBreaker.enabled: true
elasticsearch.memoryCircuitBreaker.maxPercentage: 0.9

# Request compression
elasticsearch.compression: true

# Connection pool settings
elasticsearch.maxSockets: 20
elasticsearch.keepAlive: true

# Retry settings
elasticsearch.sniffOnStart: false
elasticsearch.sniffInterval: false
elasticsearch.sniffOnConnectionFault: false

# Health check settings
elasticsearch.healthCheck.delay: 2500

# API settings
elasticsearch.apiVersion: "7.x"

# Custom headers for Wazuh integration
elasticsearch.customHeaders:
  "X-Kibana-Version": "7.17.0"
  "X-Wazuh-Lab": "true"

# Plugin settings
plugins.scanDirs: ["/usr/share/kibana/plugins"]
plugins.initialize: true

# Optimize settings
optimize.enabled: true
optimize.bundleFilter: "!tests"
optimize.bundleDir: "/usr/share/kibana/optimize/bundles"
optimize.viewCaching: true
optimize.watch: false
optimize.watchPort: 5602
optimize.watchHost: "localhost"
optimize.watchPrebuild: false
optimize.watchProxyTimeout: 10

# Status settings
status.allowAnonymous: false
status.v6ApiFormat: false

# Console settings
console.enabled: true
console.proxyFilter: [".*"]
console.proxyConfig: []

# Metrics settings
metrics.enabled: false
metrics.ops.interval: 5000

# Spaces settings (if using Elastic Stack security)
xpack.spaces.enabled: false

# Reporting settings (disabled to save memory)
xpack.reporting.enabled: false

# Security settings (using Wazuh security)
xpack.security.enabled: false

# Monitoring settings
xpack.monitoring.enabled: false
xpack.monitoring.kibana.collection.enabled: false
xpack.monitoring.ui.enabled: false

# Graph settings (disabled to save memory)
xpack.graph.enabled: false

# Machine learning settings
xpack.ml.enabled: false

# Watcher settings (disabled for lab)
xpack.watcher.enabled: false

# License settings
xpack.license_management.enabled: false

# Index management settings
xpack.index_management.enabled: false

# Snapshot and restore settings
xpack.snapshot_restore.enabled: false

# Cross cluster replication settings
xpack.cross_cluster_replication.enabled: false

# Remote clusters settings
xpack.remote_clusters.enabled: false

# Ingest pipelines settings
xpack.ingest_pipelines.enabled: false

# Rollup settings
xpack.rollup.enabled: false

# Index lifecycle management settings
xpack.index_lifecycle_management.enabled: false

# Transform settings
xpack.transform.enabled: false

# Upgrade assistant settings
xpack.upgrade_assistant.enabled: false

# Code settings (disabled to save memory)
xpack.code.enabled: false

# Infra settings (disabled to save memory)
xpack.infra.enabled: false

# Logs settings (disabled to save memory)
xpack.logs.enabled: false

# APM settings
xpack.apm.enabled: false

# Maps settings (disabled to save memory)
xpack.maps.enabled: false

# Canvas settings
xpack.canvas.enabled: false

# Lens settings
xpack.lens.enabled: true

# Dashboard mode settings
xpack.dashboard_mode.enabled: false

# Grok debugger settings
xpack.grokdebugger.enabled: true

# Painless lab settings
xpack.painless_lab.enabled: false

# Search profiler settings
xpack.searchprofiler.enabled: true

# Tilemap settings
tilemap.url: ""
tilemap.options.attribution: ""
tilemap.options.minZoom: 1
tilemap.options.maxZoom: 10
tilemap.options.subdomains: []

# Region map settings
regionmap.includeElasticMapsService: false
regionmap.layers: []

# Coordinate map settings
map.includeElasticMapsService: false
map.proxyElasticMapsServiceInMaps: false
map.tilemap.url: ""
map.tilemap.options.attribution: ""
map.tilemap.options.minZoom: 1
map.tilemap.options.maxZoom: 10

# Vega settings
vega.enableExternalUrls: false

# Interpreter settings
interpreter.enableInVisualize: true

# Data settings
data.search.aggs.shardDelay.enabled: false
data.search.sessions.enabled: false

# Expressions settings
expressions.enabled: true

# UI settings
uiSettings.overrides:
  "theme:darkMode": false
  "discover:sampleSize": 500
  "histogram:barTarget": 50
  "visualization:tileMap:maxPrecision": 7
  "csv:separator": ","
  "csv:quoteValues": true
  "search:timeout": 600000
  "courier:maxConcurrentShardRequests": 5
  "courier:batchSearches": true
  "fields:popularLimit": 10
  "histogram:maxBars": 100
  "visualize:enableLabs": false
  "notification:lifetime:banner": 3000000
  "notification:lifetime:error": 300000
  "notification:lifetime:warning": 10000
  "notification:lifetime:info": 5000
  "doc_table:highlight": true
  "discover:searchOnPageLoad": true
  "doc_table:hideTimeColumn": false
  "discover:searchFieldsFromSource": false
  "context:defaultSize": 5
  "discover:aggs:terms:size": 20
  "context:step": 5
  "accessibility:disableAnimations": false
  "ml:fileDataVisualizerMaxFileSize": "100MB"
  "ml:anomalyDetection:results:enableTimeDefaults": true
  "ml:anomalyDetection:results:timeDefaults": { "from": "now-15m", "to": "now" }
  "securitySolution:defaultAnomalyScore": 50
  "securitySolution:defaultIndex": ["wazuh-alerts-*"]
  "securitySolution:newsFeedUrl": ""
  "securitySolution:enableNewsFeed": false
  "securitySolution:ipReputationLinks": []
  "timepicker:timeDefaults": { "from": "now-15m", "to": "now" }
  "timepicker:refreshIntervalDefaults": { "pause": false, "value": 0 }
  "dashboard:enableLabsMode": false
  "visualizations:enableLabsMode": false
  "labs:presentation:enabled": false
  "labs:canvas:enabled": false
  "labs:dashboard:deferBelowFold": false