# Elasticsearch Configuration for Wazuh SOC Lab
# Optimized for 6GB RAM single-node deployment
# Generated by Ansible

# ======================== Elasticsearch Configuration =========================
#
# NOTE: Elasticsearch comes with reasonable defaults for most settings.
#       Before you set out to tweak and tune the configuration, make sure you
#       understand what are you trying to accomplish and the consequences.
#
# The primary way of configuring a node is via this file. This template lists
# the most important settings you may want to configure for a production cluster.
#
# Please consult the documentation for further information on configuration options:
# https://www.elastic.co/guide/en/elasticsearch/reference/index.html

# ---------------------------------- Cluster -----------------------------------
#
# Use a descriptive name for your cluster:
#
cluster.name: wazuh-soc-lab
#
# ------------------------------------ Node ------------------------------------
#
# Use a descriptive name for the node:
#
node.name: {{ inventory_hostname }}
#
# Add custom attributes to the node:
#
node.attr.rack: lab-rack-1
#
# ----------------------------------- Paths ------------------------------------
#
# Path to directory where to store the data (separate multiple locations by comma):
#
path.data: /var/lib/elasticsearch
#
# Path to log files:
#
path.logs: /var/log/elasticsearch
#
# ----------------------------------- Memory -----------------------------------
#
# Lock the memory on startup:
#
bootstrap.memory_lock: true
#
# Make sure that the heap size is set to about half the memory available
# on the system and that the owner of the process is allowed to use this
# limit.
#
# Elasticsearch performs poorly when the system is swapping the heap.
#
# ---------------------------------- Network -----------------------------------
#
# Set the bind address to a specific IP (IPv4 or IPv6):
#
network.host: {{ wazuh_manager_ip }}
#
# Set a custom port for HTTP:
#
http.port: 9200
#
# For more information, consult the network module documentation.
#
# --------------------------------- Discovery ----------------------------------
#
# Pass an initial list of hosts to perform discovery when this node is started:
# The default list of hosts is ["127.0.0.1", "[::1]"]
#
discovery.seed_hosts: ["{{ wazuh_manager_ip }}"]
#
# Bootstrap the cluster using an initial set of master-eligible nodes:
#
cluster.initial_master_nodes: ["{{ inventory_hostname }}"]
#
# For more information, consult the discovery and cluster formation module documentation.
#
# ---------------------------------- Gateway -----------------------------------
#
# Block initial recovery after a full cluster restart until N nodes are started:
#
#gateway.recover_after_nodes: 3
#
# For more information, consult the gateway module documentation.
#
# ---------------------------------- Various -----------------------------------
#
# Require explicit names when deleting indices:
#
action.destructive_requires_name: true

# ================================ Lab Optimizations ============================

# Single node configuration for lab environment
discovery.type: single-node

# Performance optimizations for 6GB RAM constraint
indices.memory.index_buffer_size: 20%
indices.memory.min_index_buffer_size: 96mb
indices.fielddata.cache.size: 40%
indices.breaker.fielddata.limit: 60%
indices.breaker.request.limit: 40%
indices.breaker.total.limit: 70%

# Cluster settings for single node
cluster.routing.allocation.disk.threshold_enabled: true
cluster.routing.allocation.disk.watermark.low: 85%
cluster.routing.allocation.disk.watermark.high: 90%
cluster.routing.allocation.disk.watermark.flood_stage: 95%

# Index settings optimized for lab
index.number_of_replicas: 0
index.refresh_interval: 30s
index.translog.flush_threshold_size: 1gb
index.codec: best_compression

# Network and transport settings
network.bind_host: 0.0.0.0
network.publish_host: {{ wazuh_manager_ip }}
transport.port: 9300

# HTTP settings
http.cors.enabled: true
http.cors.allow-origin: "*"
http.cors.allow-methods: OPTIONS, HEAD, GET, POST, PUT, DELETE
http.cors.allow-headers: X-Requested-With, X-Auth-Token, Content-Type, Content-Length, Authorization

# Security settings
xpack.security.enabled: false
xpack.monitoring.enabled: false
xpack.ml.enabled: false
xpack.watcher.enabled: false

# Thread pool settings for lab environment
thread_pool.write.queue_size: 1000
thread_pool.search.queue_size: 1000
thread_pool.get.queue_size: 1000

# Logging configuration
logger.level: INFO
logger.org.elasticsearch.discovery: DEBUG

# JVM settings will be handled in jvm.options file
# Heap size: 2g (optimized for 6GB RAM system)

# Index lifecycle management
indices.lifecycle.poll_interval: 10m

# Search settings
search.max_buckets: 65536
search.allow_expensive_queries: true

# Indexing settings
index.max_result_window: 100000
index.max_rescore_window: 100000

# Snapshot settings
path.repo: ["/var/lib/elasticsearch/snapshots"]

# Audit logging (disabled for lab)
xpack.security.audit.enabled: false

# SQL settings
xpack.sql.enabled: false

# Graph settings
xpack.graph.enabled: false

# License settings
xpack.license.self_generated.type: basic

# Rollup settings
xpack.rollup.enabled: false

# Transform settings
xpack.transform.enabled: false

# Data frame settings
xpack.data_frame.enabled: false

# CCR settings
xpack.ccr.enabled: false

# ILM settings
xpack.ilm.enabled: true

# SLM settings
xpack.slm.enabled: false

# Enrich settings
xpack.enrich.enabled: false

# EQL settings
xpack.eql.enabled: true

# Async search settings
xpack.async_search.enabled: true

# Data streams settings
xpack.data_streams.enabled: true

# Searchable snapshots settings
xpack.searchable.snapshot.enabled: false

# Runtime fields settings
xpack.runtime_fields.enabled: true

# Frozen indices settings
xpack.frozen_indices.enabled: false

# Spatial settings
xpack.spatial.enabled: true

# Vectors settings
xpack.vectors.enabled: true

# Analytics settings
xpack.analytics.enabled: false

# Deprecation settings
cluster.deprecation_indexing.enabled: false

# Persistent tasks settings
persistent_tasks.allocation.enable: all

# Cluster coordination settings
cluster.max_voting_config_exclusions: 1

# Node roles (all roles for single node)
node.roles: [ master, data, data_content, data_hot, data_warm, data_cold, data_frozen, ingest, ml, remote_cluster_client, transform ]

# Disk allocation settings
cluster.routing.allocation.disk.include_relocations: true

# Shard allocation settings
cluster.routing.allocation.enable: all
cluster.routing.rebalance.enable: all

# Recovery settings
indices.recovery.max_bytes_per_sec: 100mb
cluster.routing.allocation.node_concurrent_recoveries: 2
cluster.routing.allocation.node_initial_primaries_recoveries: 4

# Store settings
index.store.type: fs
index.store.fs.fs_lock: simple

# Merge settings
index.merge.policy.max_merge_at_once: 10
index.merge.policy.segments_per_tier: 10

# Warmer settings
index.warmer.enabled: true

# Cache settings
indices.requests.cache.size: 2%
indices.queries.cache.size: 10%

# Bulk settings
bulk.udp.enabled: false

# Script settings
script.allowed_types: inline
script.allowed_contexts: search, update, ingest

# Painless settings
script.painless.regex.enabled: true

# Mustache settings
script.mustache.enabled: true

# Expression settings
script.expression.enabled: true

# Plugin settings
plugin.mandatory: []

# Tribe settings (deprecated)
# tribe.name: ""

# Custom settings for Wazuh integration
action.auto_create_index: true
cluster.blocks.read_only: false
cluster.blocks.read_only_allow_delete: false

# Wazuh specific index patterns
action.auto_create_index: +wazuh-*,+.wazuh-*,-*

# Template settings
cluster.indices.close.enable: true

# Snapshot settings
snapshot.max_concurrent_operations: 5

# Allocation awareness (not needed for single node)
# cluster.routing.allocation.awareness.attributes: ""

# Hot-warm architecture (not applicable for single node)
# node.attr.box_type: hot

# Cross-cluster search settings
search.remote.connect: false

# Field mapping settings
index.mapping.total_fields.limit: 2000
index.mapping.depth.limit: 20
index.mapping.nested_fields.limit: 100
index.mapping.nested_objects.limit: 10000

# Analysis settings
index.max_ngram_diff: 50
index.max_shingle_diff: 8

# Similarity settings
index.similarity.default.type: BM25

# Slow log settings
index.search.slowlog.threshold.query.warn: 10s
index.search.slowlog.threshold.query.info: 5s
index.search.slowlog.threshold.query.debug: 2s
index.search.slowlog.threshold.query.trace: 500ms

index.search.slowlog.threshold.fetch.warn: 1s
index.search.slowlog.threshold.fetch.info: 800ms
index.search.slowlog.threshold.fetch.debug: 500ms
index.search.slowlog.threshold.fetch.trace: 200ms

index.indexing.slowlog.threshold.index.warn: 10s
index.indexing.slowlog.threshold.index.info: 5s
index.indexing.slowlog.threshold.index.debug: 2s
index.indexing.slowlog.threshold.index.trace: 500ms

# GC logging
monitor.jvm.gc.enabled: true
monitor.jvm.gc.overhead.warn: 50
monitor.jvm.gc.overhead.info: 25
monitor.jvm.gc.overhead.debug: 10

# Process settings
monitor.process.enabled: true
monitor.process.refresh_interval: 1s

# OS settings
monitor.os.enabled: true
monitor.os.refresh_interval: 1s

# FS settings
monitor.fs.enabled: true
monitor.fs.refresh_interval: 1s

# JVM settings
monitor.jvm.enabled: true
monitor.jvm.refresh_interval: 1s